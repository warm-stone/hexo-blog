---
title: 【投票】项目开发日记
date: 2025-07-27 01:19:51
tags:
  - 开发日记
---

# 【投票】项目开发日记

### 简述

起先是闲扯群里人越来越多，偶尔有些稍有猎奇的玩笑话，后来给某些经常有猎奇发言的人进行了【变态等级】定级，也恰好是有时间，便用 python 简单写了 300+ 行代码，放在公司服务器供大家投票、记录变态等级。
后来有些人在榜单中添加了美食、纪念堂等等一些榜单，这些暗合我之前设想的【辨明】项目的一部分，也恰逢公司网络管控，一些同学无法访问内网站点，于是公网项目被提上日程

### 需求记录

1. 项目首页为投票榜单，展示所有榜单，提供榜单导航
2. 登录用户可以添加榜单，创建者为榜单管理员，拥有榜单的一定编辑权限
3. 榜单管理员不应该有用榜单的全部编辑权限，以防止管理员修改涉及自身的项目，如管理员的【变态等级】榜单昵称，这种榜单编辑应该触发编辑事件，编辑事件是否成功油榜单成员决定
4. 榜单有【通告】功能，以实现某些投票功能
5. 可以发起临时投票，以解决变更通告投票问题
4. 身份标识候选： 邮箱、电话、微信、QQ、匿名、ipv6地址


1. 榜单、投票项、临时投票、榜单通告

#### 表结构

用户：  
id，账号， 密码哈希，name，邮箱，电话，微信，QQ，头像，创建时间，最后修改时间，删除时间，是否删除

榜单： rank_list    
id，榜单名，榜单描述，头像，赞同名称，反对名称, 创建者id，  创建时间，最后修改时间，删除时间，是否删除

投票项：
id，榜单id，名称，描述，头像，票数，  创建时间，最后修改时间，删除时间，是否删除

榜单通告：rank_list_announcement  
id, 榜单id， 名称，描述，内容，过期时间，创建时间，最后修改时间，删除时间，是否删除

修改申请表：
id， 修改项目（榜单/投票项），目标id，目标操作，目标值，过期时间，创建时间，最后修改时间，删除时间，是否删除



#### 25年7月26日

思路有些混乱，定实体关系时发现权限管控有些复杂，事实上对行级数据权限进行管理的案例还是比较少，今天了解了 ABAC 权限控制，有了些许眉目，明天需要在了解下用户登录方面的权限控制，
另外需要将表结构设计一下

#### 25年7月29日

进度有点慢，今天刚刚建完表，修改操作太复杂了，需要思考的细节太多，还是先上线基础功能吧

#### 25年7月31日

CRUD已基本打通，梳理下接下来的主要工作  
1. 用户登录、权限管理，session管理
2. nginx单端口代理前后端

#### 25年8月6日

后端 jwt 认证已基本完成 oauth2 github 授权登录仍需要设计一下  
问题与待办：  
1. lombok 不可使用问题 （编译无问题，运行报错，找不到方法）
2. github 认证流程实现
3. 前端编码


#### 25年8月10日

1. 前端东西忘没了，明天回来早需要把 github 认证前后端串联起来
2. 添加投票主页

#### 25年8月11日

1. 遇到奇怪的问题，前端项目突然只能 `localhost` 访问，而不能 `127.0.0.1` 访问了，环境变量也读不出来了，暂时没有头绪
    > sb 了，可能是之前都用localhost访问的吧
2. github认证受限于重定向保护，前端需要做一个认证页面


#### 25年8月13日

卡在 `oauth2`认证好久了，今天定位到了原因，总结一下，这周搞定
1. `oauth` 认证过程中需要保留 `session` ，无状态请求会导致无限重定向，直到访问到访问过的线程（存疑）
2. `spring security`  跨域问题需要单独处理