---
title: 网络基础
date: 2024-09-28 01:05:43
categories:
tags:
  - 网络
  - 网桥
  - 虚拟平台
  - 软路由
---

在虚拟平台、软路由中默认网络接入通常不是硬件设备，而是虚拟网桥，因为平台和软路由需要将本机网络分享给其复杂上的虚拟机和容器，使用网桥会更灵活  

# ipv6  

简述：  
目前多数设备均支持ipv6，并且正常情况ipv6响应速度和优先级高于ipv4。  
网络问题排查顺序:
1. dns 排除域名解析问题
2. ping ip 此步有问题可能为网络问题或防火墙问题
3. curl ip 可能为防火墙问题

如果存在代理，代理可能导致任何步骤失败


设置要点：  
1. DHCP  
   ipv6 本地地址`fe::`由主机根据 Mac 自动生成，dhcp 服务器由需要将ip前缀通告给设备，设备使用根据前缀生成响应的公网地址。ipv6 DHCP 服务分为两部分
   1. RA 通告，通告网关、DNS 服务器、前缀
   2. DHCP 地址分配，地址分配会给主机相应的标识或地址，主机根据标识和mac地址**自动生成ipv6地址**或使用分配地址
   3. dhcpv6 末端服务需要设置前缀 64,
2. DNS  
   DNS 服务器不是必须为 ipv6 地址，ipv4 服务器同样可以返回ipv6 地址，但是 window`nslookup`有时会仅显示 ipv4 结果
3. lan 间通信  
   lan 间通信需要防火墙转发或者在同一网桥中，并不是防火墙允许、路由正确就可以转发

**注意事项：**  

1. windows 、 linux 、 Android 平台 ping 、nslookup 存在差异  
   windows 直接 `ping`，不区分版本， linux 部分区分 `ping`、`ping6`  
   `nslookup`windows 偶尔只返回 ipv4 结果，需要使用 ipv6 dns 才能得到 ipv6 地址， linux 无论 dns 服务器 ipv 版本会全部返回  


# 排障案例

### linux 机器两个网口，连接同一路由器，一个通，一个不通

ipv4可以ping通，ipv6不可以，且`ipv6`公网地址获取奇慢，不触发上线通告，需要等待路由器默认`RA`通告才能获取ipv6地址

**结果：**
防火墙拦截了`eth1`的请求，只允许进站数据，系统不存在偏向


### openwrt 防火墙分区，只允特定设备提供外部服务

受限于以下原因：
1. istore 截止 25-09-22 防火墙`ip-set`存在问题，不能有效过滤请求
2. 固定目的地过滤不能解决`ipv6`地址前缀变动问题

目前追加解决方案为添加网口，单独设置`expose`区域，暴露区需要密码安全，安全区依靠防火墙拦截恶意嗅探

![防火墙区域](./img/network_防火墙expose.png)


